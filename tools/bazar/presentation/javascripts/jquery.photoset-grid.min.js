/**
 * photoset-grid - v1.0.0
 * 2013-03-07
 * jQuery plugin to arrange images into a flexible grid
 * http://stylehatch.github.com/photoset-grid/
 *
 * Copyright 2013 Jonathan Moore - Style Hatch
 */
(function(t, i, s, e) {
  function o(i, s) { this.element = i, this.options = t.extend({}, a, s), this._defaults = a, this._name = n, this.init() } var n = 'photosetGrid'; var a = { width: '100%', gutter: '0px', highresLinks: !1, lowresWidth: 500, rel: '', onInit() {}, onComplete() {} }; o.prototype = { init() { this.options.onInit(), this._setupRows(this.element, this.options), this._setupColumns(this.element, this.options) }, _callback() { this.options.onComplete() }, _setupRows(i, s) { if (s.layout) this.layout = s.layout; else if (t(i).attr('data-layout')) this.layout = t(i).attr('data-layout'); else { for (var e = '', o = 1, n = 0; t(i).find('img').length > n; n++)e += `${o}`; this.layout = e } this.rows = this.layout.split(''); for (const a in this.rows) this.rows[a] = parseInt(this.rows[a], 10); const h = t(i).find('img'); let r = 0; t.each(this.rows, (t, i) => { const s = r; const e = r + i; h.slice(s, e).wrapAll(`<div class="photoset-row cols-${i}"></div>`), r = e }), t(i).find('.photoset-row:not(:last-child)').css({ 'margin-bottom': s.gutter }) }, _setupColumns(s, e) { const o = this; const n = function() { function o() { const i = `${t(s).width()}`; i !== t(s).attr('data-width') && (n.each(function() { let i = t(this).find('img:eq(0)'); t(this).find('img').each(function() { const s = t(this); s.height() < i.height() && (i = t(this)), s.width() > e.lowresWidth && s.attr('data-highres') && s.attr('src', s.attr('data-highres')) }); const s = i.height(); const o = Math.floor(0.025 * s); t(this).height(s - o), t(this).find('img').each(function() { const i = `${0.5 * (s - t(this).height())}px`; t(this).css({ 'margin-top': i }) }) }), t(s).attr('data-width', i)) } var n = t(s).find('.photoset-row'); const a = t(s).find('img'); e.highresLinks ? (a.each(function() { let i; i = t(this).attr('data-highres') ? t(this).attr('data-highres') : t(this).attr('src'), t(this).wrapAll(`<a href="${i}" class="photoset-cell highres-link" />`) }), e.rel && a.parent().attr('rel', e.rel)) : a.each(function() { t(this).wrapAll('<div class="photoset-cell" />') }); const h = t(s).find('.photoset-cell'); const r = t(s).find('.cols-1 .photoset-cell'); const l = t(s).find('.cols-2 .photoset-cell'); const c = t(s).find('.cols-3 .photoset-cell'); const d = t(s).find('.cols-4 .photoset-cell'); const f = t(s).find('.cols-5 .photoset-cell'); t(s).css({ width: e.width }), n.css({ clear: 'left', display: 'block', overflow: 'hidden' }), h.css({ float: 'left', display: 'block', 'line-height': '0', '-webkit-box-sizing': 'border-box', '-moz-box-sizing': 'border-box', 'box-sizing': 'border-box' }), a.css({ width: '100%', height: 'auto' }), r.css({ width: '100%' }), l.css({ width: '50%' }), c.css({ width: '33.3%' }), d.css({ width: '25%' }), f.css({ width: '20%' }); const u = parseInt(e.gutter, 10); t(s).find('.photoset-cell:not(:last-child)').css({ 'padding-right': `${u / 2}px` }), t(s).find('.photoset-cell:not(:first-child)').css({ 'padding-left': `${u / 2}px` }), o(), t(i).on('resize', () => { o() }) }; t(s).imagesLoaded(() => { n(), o._callback() }) } }, t.fn[n] = function(i) { return this.each(function() { t.data(this, `plugin_${n}`) || t.data(this, `plugin_${n}`, new o(this, i)) }) }; const h = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='; t.fn.imagesLoaded = function(i) { function s() { const s = t(f); const e = t(u); r && (u.length ? r.reject(c, s, e) : r.resolve(c)), t.isFunction(i) && i.call(a, c, s, e) } function o(t) { n(t.target, t.type === 'error') } function n(i, e) { i.src !== h && t.inArray(i, d) === -1 && (d.push(i), e ? u.push(i) : f.push(i), t.data(i, 'imagesLoaded', { isBroken: e, src: i.src }), l && r.notifyWith(t(i), [e, c, t(f), t(u)]), c.length === d.length && (setTimeout(s), c.unbind('.imagesLoaded', o))) } var a = this; var r = t.isFunction(t.Deferred) ? t.Deferred() : 0; var l = t.isFunction(r.notify); var c = a.find('img').add(a.filter('img')); var d = []; var f = []; var u = []; return t.isPlainObject(i) && t.each(i, (t, s) => { t === 'callback' ? i = s : r && r[t](s) }), c.length ? c.bind('load.imagesLoaded error.imagesLoaded', o).each((i, s) => { const o = s.src; const a = t.data(s, 'imagesLoaded'); return a && a.src === o ? (n(s, a.isBroken), e) : s.complete && s.naturalWidth !== e ? (n(s, s.naturalWidth === 0 || s.naturalHeight === 0), e) : ((s.readyState || s.complete) && (s.src = h, s.src = o), e) }) : s(), r ? r.promise(a) : a }; let r; let l; let c; const d = t.event; const f = { _: 0 }; let u = 0; r = d.special.throttledresize = { setup() { t(this).on('resize', r.handler) }, teardown() { t(this).off('resize', r.handler) }, handler(i, s) { const e = this; const o = arguments; l = !0, c || (setInterval(() => { u++, (u > r.threshold && l || s) && (i.type = 'throttledresize', d.dispatch.apply(e, o), l = !1, u = 0), u > 9 && (t(f).stop(), c = !1, u = 0) }, 30), c = !0) }, threshold: 0 }
}(jQuery, window, document))
